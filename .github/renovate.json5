{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: [
    "config:best-practices",
    ":semanticCommitTypeAll(deps)",
    ":semanticCommitScopeDisabled",
    // Eliminado schedule:weekly para usar cron personalizado
    "group:allNonMajor",
    "helpers:pinGitHubActionDigests",
  ],
  enabledManagers: [
    "github-actions",
    "gradle",
    "gradle-wrapper",
    "npm",
    "pnpm",
    "maven",
    "regex",
  ],
  semanticCommitType: "deps",
  semanticCommitScope: "",
  labels: ["type|dependency-upgrade", "pr|deps"],
  ignorePaths: ["**/__tests__/**"],

  // --- CONFIGURACIÓN DE TIEMPO Y ESTABILIDAD ---
  // Hora UTC (ajustar según tu zona horaria si es necesario)
  timezone: "UTC",
  // Cron: Cualquier minuto, Horas 22-23 y 0-7, Cada 3 días del mes (1, 4, 7...)
  schedule: ["* 22-23,0-7 */3 * *"],
  // Estabilidad: Esperar 3 días antes de crear PRs
  minimumReleaseAge: "3 days",
  
  pinDigests: true,
  ignoreUnstable: false,
  dependencyDashboard: true,
  vulnerabilityAlerts: {
    enabled: true,
  },
  osvVulnerabilityAlerts: true,

  automerge: true,
  automergeStrategy: "squash",

  packageRules: [
    // --- GITHUB ACTIONS ---
    {
      description: "Automerge GitHub Actions (minor/patch/digest)",
      matchManagers: ["github-actions"],
      // Incluimos 'digest' porque helpers:pinGitHubActionDigests convierte updates en digest changes
      matchUpdateTypes: ["minor", "patch", "digest"], 
      automerge: true,
    },
    {
      description: "Group major GitHub Actions updates",
      matchManagers: ["github-actions"],
      matchUpdateTypes: ["major"],
      groupName: "GitHub Actions (major)",
      automerge: false,
    },

    // --- GRADLE / LIBS ---
    {
      description: "Filtrar versiones inestables en catalogos",
      matchFileNames: ["**/rcLibs.versions.toml"],
      allowedVersions: "!/(-M|-m|-beta|-Beta|-BETA|-alpha|-Alpha|-ALPHA|-snapshot|-Snapshot|-SNAPSHOT)/",
    },
    {
      matchFileNames: ["**/betaLibs.versions.toml"],
      allowedVersions: "!/(-alpha|-Alpha|-ALPHA|-snapshot|-Snapshot|-SNAPSHOT)/",
    },
    {
      matchFileNames: ["**/alphaLibs.versions.toml"],
      allowedVersions: "!/(-snapshot|-Snapshot|-SNAPSHOT)/",
    },

    // --- MANTENIMIENTO ---
    {
      matchManagers: ["npm", "pnpm"],
      matchFileNames: ["docs/website/**"],
      lockFileMaintenance: {
        enabled: true,
      },
    },

    // --- AGRUPACIONES ---
    {
      matchPackageNames: ["org.gradlex.**"],
      groupName: "gradlex",
    },
    {
      matchPackageNames: ["org.jetbrains.kotlin.**"],
      groupName: "kotlin",
    },
    {
      matchPackageNames: ["org.springframework.boot.**"],
      groupName: "spring boot",
    },
  ],

  customManagers: [
    {
      customType: "regex",
      description: "Update gradle version in toml",
      managerFilePatterns: ["\\.versions\\.toml$"],
      matchStrings: ['(^|\\n)\\s*gradle\\s*=\\s*"(?<currentValue>[^"]*)"'],
      depNameTemplate: "gradle",
      datasourceTemplate: "gradle-version",
    },
    {
      customType: "regex",
      description: "Update node version in toml",
      managerFilePatterns: ["\\.versions\\.toml$"],
      matchStrings: ['(^|\\n)\\s*node\\s*=\\s*"(?<currentValue>[^"]*)"'],
      depNameTemplate: "node",
      datasourceTemplate: "node-version",
    },
    {
      customType: "regex",
      description: "Update kotlin stdlib version in toml",
      managerFilePatterns: ["\\.versions\\.toml$"],
      matchStrings: ['(^|\\n)\\s*kotlin\\s*=\\s*"(?<currentValue>[^"]*)"'],
      depNameTemplate: "org.jetbrains.kotlin:kotlin-stdlib",
      datasourceTemplate: "maven",
    },
    {
      customType: "regex",
      description: "Update jdk version in toml",
      managerFilePatterns: ["\\.versions\\.toml$"],
      matchStrings: ['(^|\\n)\\s*jdk\\s*=\\s*"(?<currentValue>[^"]*)"'],
      depNameTemplate: "java",
      datasourceTemplate: "java-version",
    },
    {
      customType: "regex",
      description: "Update InternalDependencies.kt",
      managerFilePatterns: ["gradle/**/InternalDependencies\\.kt"],
      matchStrings: [
        '[a-zA-Z0-9_]+\\s*=\\s*\\{\\s*module\\s*=\\s*"(?<depName>[^" ]+)"\\s*,\\s*version\\s*=\\s*"(?<currentValue>[^" ]+)"\\s*,\\s*type\\s*=\\s*"(?<datasource>[^" ]+)"[^}]*\\}',
      ],
    },
  ],
}
